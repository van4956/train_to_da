
Как в PostgreSQL посчитать перцентиль (например, p95) с помощью оконной функции?

---

В PostgreSQL для расчёта перцентилей используется агрегатная функция `percentile_cont`. В сочетании с `OVER (PARTITION BY …)` она позволяет посчитать перцентиль без `GROUP BY`, возвращая значение для каждой строки внутри группы.

```sql
percentile_cont(0.95)  -- непрерывный 95-й перцентиль
within group (order by response_ms)  -- по какому полю считаем
over (partition by endpoint)  -- считаем отдельно для каждого endpoint
```

---

#lvl_3 