
Как работает оконная функция `LAG` и для чего она используется?

---

`LAG` позволяет получить значение из предыдущей строки внутри окна без использования self join. Часто применяется для расчёта разницы между текущим и предыдущим значением, например изменения суммы покупки.

```sql
amount - lag(amount) over (partition by user_id order by paid_at)
```

Считает разницу между текущей и предыдущей покупкой пользователя.

---

#lvl_3 