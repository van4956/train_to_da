
Как построить SQL-воронку `signup → checkout → purchase`?  
Есть таблица `events(user_id, event_name, event_time)`.

---

SQL-воронка строится по пользователям с учётом порядка событий.  
Сначала фиксируем для каждого пользователя время первого шага, затем считаем, сколько пользователей дошли до каждого следующего шага.

```sql
SELECT
  SUM(CASE WHEN signup_time IS NOT NULL THEN 1 ELSE 0 END) AS signup,
  SUM(CASE WHEN checkout_time IS NOT NULL THEN 1 ELSE 0 END) AS checkout,
  SUM(CASE WHEN purchase_time IS NOT NULL THEN 1 ELSE 0 END) AS purchase
FROM funnel;
```

---

#lvl_3 